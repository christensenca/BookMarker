<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BookMarker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h2>Books</h2>
            {% for book in books %}
            <div class="book">
                <a href="?book_id={{ book.id }}" style="text-decoration: none; color: inherit;">
                    <strong>{{ book.title }}</strong><br>
                    by {{ book.author }}<br>
                    Highlights: {{ book.highlight_count }}<br>
                    Last: {{ book.last_highlight_date or 'N/A' }}
                </a>
            </div>
            {% endfor %}
        </div>
        <div class="main">
            <div class="search-form">
                <form method="get">
                    <input type="text" name="q" value="{{ query }}" placeholder="Search highlights, titles, authors..." style="width: 70%; padding: 5px;">
                    <button type="submit" style="padding: 5px 10px;">Search</button>
                    {% if query %}<a href="/" style="margin-left: 10px;">Clear</a>{% endif %}
                </form>
            </div>
            {% if query %}
            <h1>Search Results for "{{ query }}"</h1>
            {% if highlights %}
            {% for highlight, book, highlighted_quote, highlighted_title, highlighted_author in highlights %}
            <div class="highlight">
                <div class="meta">
                    <strong>{{ highlighted_title }}</strong> by {{ highlighted_author }}<br>
                    Type: {{ highlight.highlight_type }} | Location: {{ highlight.location }} | Date: {{ highlight.date_added }}
                    {% if highlight.page %} | Page: {{ highlight.page }}{% endif %}
                </div>
                <p>{{ highlighted_quote | safe }}</p>
            </div>
            {% endfor %}
            {% else %}
            <p>No results found.</p>
            {% endif %}
            {% elif selected_book %}
            <h1>{{ selected_book.title }}</h1>
            <h2>by {{ selected_book.author }}</h2>
            {% for highlight in highlights %}
            <div class="highlight">
                <div class="meta">
                    Type: {{ highlight.highlight_type }} | Location: {{ highlight.location }} | Date: {{ highlight.date_added }}
                    {% if highlight.page %} | Page: {{ highlight.page }}{% endif %}
                </div>
                <p>{{ highlight.quote }}</p>
            </div>
            {% endfor %}
            {% else %}
            <h1>Select a book from the sidebar or search</h1>
            {% endif %}
        </div>
    </div>
</body>
</html>